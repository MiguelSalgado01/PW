<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Registar Utilizador</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
         <!--JQUERY-->
         <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.2/jquery.min.js" integrity="sha512-tWHlutFnuG0C6nQRlpvrEhE4QpkG1nn2MOUMWmUeRePl4e3Aki0VB6W1v3oLjFtd0hVOtRQ9PHpSfN6u6/QXkQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
         <!--BootStrap 5.2-->
         <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
        <link rel="stylesheet" href="style.css"> 
    </head>
    
    <body class="bg-primary">
        <header class=" rounded-4 p-3">
            <div class="row align-items-center">
                <div class="m-2 d-flex justify-content-center ">
                    <h2 class="my-1 fw-bold text-white">Registar Utilizador</h2>
                </div>
            </div>
        </header>
        <div style=" width: 90%" class="container bg-light rounded-5 p-3 shadow-lg">
            <div class="container w-100 col-6">
                <div class="my-4">Nome Utilizador
                    <div class="input-group my-1 needs-validation">
                        <span class="input-group-text bg-secondary" id="basic-addon1">                    
                            <i class="fa fa-user text-white"></i>
                        </span>
                        <input type="text" class="form-control" id="username" placeholder="ex: Nikola Tesla" maxlength="50" required>
                       
                    </div>
                </div>
                <div class="my-4">Numero de Estudante
                    <div class="input-group my-1 needs-validation">
                        <span class="input-group-text bg-secondary" id="basic-addon1">                    
                            <i class="fa fa-university text-white"></i>
                        </span>
                        <input type="text" class="form-control" id="schoolNumber" maxlength="9" placeholder="ex: a21711943" required> 
                        <div class="invalid-feedback">
                            Por Favor insira Numero de Estudante
                        </div>
                    </div>
                </div>
                <div class="my-4">Contacto
                    <div class="input-group my-1 needs-validation">
                        <span class="input-group-text bg-secondary" id="basic-addon1">                    
                            <i class="fa fa-phone text-white"></i>
                        </span>
                        <input type="text" class="form-control" id="userContact" maxlength="9" placeholder="ex: 919100756" required> 
                        <div class="invalid-feedback">
                            Por Favor insira Contacto
                        </div>
                    </div>
                </div>
                <div class="my-4">Password
                    <div class="input-group my-1 needs-validation">
                        <span class="input-group-text bg-secondary" id="basic-addon1">                    
                            <i class="fa fa-key text-white"></i>
                        </span>
                        <input type="text" class="form-control" id="userPassword" placeholder="ex: Bobin@D3Te5L@" required> 
                        <div class="invalid-feedback">
                            Por Favor insira Password
                        </div>
                    </div>
                </div>
                <div class="my-4">Confirmar Password
                    <div class="input-group my-1 needs-validation" id="rePass">
                        <span class="input-group-text bg-secondary" id="basic-addon1">                    
                            <i class="fa fa-key text-white"></i>
                        </span>
                        <input type="text" class="form-control" id="confPassword" 
                            placeholder="ex: Bobin@D3Te5L@" required> 
                        <div class="invalid-feedback">
                            Por Favor insira a mesma Password
                        </div>
                    </div>
                </div>
                <div class="my-4">Genero
                    <div class="input-group my-1 needs-validation">
                        <label class="input-group-text bg-secondary" for="userGender">
                            <i class="fa fa-venus-mars text-white"></i>
                        </label>
                        <select class="form-select" id="userGender" required>
                            <option disabled selected value="">Selecione o seu Genero</option>
                            <option value="Feminino">Feminino</option>
                            <option value="Masculino">Masculino</option>
                        </select>
                        <div class="invalid-feedback">
                            Por Favor insira Genero
                        </div>
                    </div>  
                </div>
                <div class="container">
                    <div class="row justify-content-center ">
                        <button class="btn btn-outline-secondary col-6 my-2" type="submit" id="submitBtn" onclick="clicarBotao()">Guardar Alterações</button> 
                    </div>
                </div>
            </div>
        </div>
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous">
        </script>
        <script>
            var validationSpaces = document.getElementsByClassName("needs-validation"); 
            var userName = document.getElementById("username");
            var userNumb = document.getElementById("schoolNumber");
            var userPhone = document.getElementById("userContact");
            var userPass = document.getElementById("userPassword");
            var userConfPass = document.getElementById("confPassword");
            var userGen = document.getElementById("userGender");
            var buttonSubmit = document.getElementById("submitBtn");
            var rePassVal = 0, user = new Array();

            $( document ).ready(
                events,
                // validateConfPassword(),
            );

            function events($, undefined) {
                "use strict";
                $(function() {
                    userPhone.addEventListener( "keyup", function( event ) {
                        var $this = $(this);
                        var input = $this.val();
                        userPhone.value = input.replace(/[A-Za-z\W\s\._\-]/g, '');
                    }); 
                    userNumb.addEventListener( "keyup", function( event ) {
                        var $this = $(this);
                        var input = $this.val();
                        var firstChar = input[0];
                        var minusFirst = input.slice(1, input.size);
                        userNumb.value = firstChar.replace(/[0-9\\s\._\-]+/g, '') + minusFirst.replace(/[A-Za-z\\s\._\-]+/g, '');
                        console.log(input)
                    }); 
                }); 
            }

            function clicarBotao(){
                var numFaltas = 0, idUser = 1, users =  [];

                numFaltas = validateSpaces(numFaltas);
                users = JSON.parse(localStorage.getItem('users'));

                if(users !== null)
                    idUser++;

                if(numFaltas === 0){
                    user.push({
                        "idUser" : idUser,
                        "studentNumb" : userNumb.value,
                        "Name" : userName.value,
                        "contact" : userPhone.value,
                        "password" : userPass.value,
                        "gender": userGen.value
                    });
                    console.log(users);

                    localStorage.setItem('users', JSON.stringify(user));
                    clearPage();
                    // verPerfilPage();
                }
            }

            function validateConfPassword() {
        
                if(userConfPass.value !== userPass.value){
                    userConfPass.classList.add("is-invalid");
                    userConfPass.classList.remove("is-valid");
                    userConfPass.classList.remove("was-validated");
                    rePassVal = 1;
                }
                if (userConfPass.value === userPass.value) {
                    userConfPass.classList.add("is-valid");
                    userConfPass.classList.remove("is-invalid")
                    userConfPass.classList.add("was-validated");
                    rePassVal = 0;
                }
            }

            function validateSpaces(numFaltas){
                validateConfPassword();

                for (let index = 0; index < validationSpaces.length; index++) {
                    const element = validationSpaces[index];
                    if(element.id !== "rePass")
                        element.classList.add("was-validated");

                    if (!element.childNodes[3].validity.valid)
                        numFaltas++;   
                }
                numFaltas += rePassVal; 

                console.log(numFaltas)
                return numFaltas;
            }

            function clearPage(){

            for (let index = 0; index < validationSpaces.length; index++) {
                    const element = validationSpaces[index];
                    element.childNodes[3].value = ''
                    element.classList.remove("was-validated");
            }
            userConfPass.classList.remove("is-valid");
        }
        </script>
    </body>
</html>